# 安全在庫最適化シミュレーションツール

## 概要

本ツールは、PSI（計画・販売・在庫）運用の実態に即した安全在庫を算出・可視化し、計画精度と在庫量の連動管理を実現するStreamlitアプリケーションです。

## 特徴

- **3つの安全在庫モデル**を比較分析
  - 安全在庫①：理論値（教科書基準）
  - 安全在庫②：実測値（実績−平均）
  - 安全在庫③：実測値（実績−計画）【推奨】
- **AI需要予測**との連携を考慮した設計
- **欠品許容率**の動的調整（1〜50%、デフォルト5%）
- **リードタイム**の柔軟な設定（稼働日/カレンダー日）
- **EXE配布**対応（PyInstaller使用）

## システム要件

- Python 3.13.x
- Windows 10/11
- メモリ: 4GB以上推奨
- ディスク容量: 500MB以上

## インストール方法

### 1. 仮想環境の作成

```bash
python -m venv venv
venv\Scripts\activate
```

### 2. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 3. アプリケーションの起動

```bash
streamlit run app.py
```

**注意**：初回起動時は、`data/`ディレクトリにサンプルデータが含まれているため、そのまま動作確認が可能です。実データを使用する場合は、`data/`ディレクトリに実データファイルを配置してください。

## EXE化（配布用）

### 1. PyInstallerでのビルド

```bash
pyinstaller SafetyStock-SimOptimizer_ver1.spec
```

### 2. 配布ファイルの確認

ビルド後、`dist/SafetyStock-SimOptimizer_ver1/` フォルダに実行ファイルが生成されます。

## 使用方法

### 1. 機種選択

サイドバーから分析対象の機種を選択します。
- 複数選択可能
- トライアル対象：TT-157092-AWAA, TT-157132-AWAA, KK-C14682-AWAA

### 2. リードタイム設定

- **稼働日数**：土日祝除く
- **カレンダー日数**：土日祝含む
- 最大60日まで設定可能

### 3. 欠品許容率設定

- 1〜50%の範囲で設定
- デフォルト：5%（P95）
- 精度や業務特性に応じて調整

### 4. 分析結果の確認

- **安全在庫の定義・計算式**：3モデルの定義と計算式を表示
- **統計情報**：各商品の統計情報を表形式で表示
- **LT間差分分布**：ヒストグラムで差分分布を可視化（横軸レンジ統一）
- **安全在庫比較結果**：3モデルの安全在庫値を比較

### 5. エクスポート

- **PNG形式**：グラフを画像として保存
- **CSV形式**：分析結果を表形式で保存
- **画面キャプチャ**：現在の画面を保存

## データ形式

### サンプルデータ

本リポジトリには、動作確認用のサンプルデータが含まれています：

- **日次実績データ**：`data/日次実績データ.csv`
  - トライアル対象3機種（TT-157092-AWAA, TT-157132-AWAA, KK-C14682-AWAA）
  - 2024年6月の稼働日データ
- **月次計画データ**：`data/月次計画データ.csv`
  - 2024年6月〜2025年5月の月次計画データ
- **ABC区分データ**：`data/ABC区分データ.csv`（オプション）
- **稼働日マスタ**：`data/稼働日マスタ.csv`（オプション）
- **安全在庫データ**：`data/安全在庫データ.csv`（オプション）

### 入力データ形式

- **日次計画データ**：`data/日次計画データ.csv`（存在しない場合は月次計画データから自動変換）
- **日次実績データ**：`data/日次実績データ.csv`
- 形式：行=商品コード、列=日付（YYYYMMDD）、セル=数量
- エンコーディング：UTF-8-BOM推奨

### 実データの使用方法

実データを使用する場合は、`data/`ディレクトリに以下のファイルを配置してください：

- `日次実績データ.csv`：必須
- `日次計画データ.csv` または `月次計画データ.csv`：必須（月次計画データの場合は自動的に日次に変換されます）
- `ABC区分データ.csv`：オプション
- `稼働日マスタ.csv`：オプション（存在しない場合はデフォルト値を使用）
- `安全在庫データ.csv`：オプション

**注意**：実データファイルは`.gitignore`で除外されているため、GitHubにはアップロードされません。

## 安全在庫モデル詳細

### 安全在庫①：理論値（教科書基準）

```
安全在庫① = Z × σ × √L
```

- Z：欠品許容率pの片側Z値
- σ：日次実績の標準偏差
- L：指定リードタイム（稼働日ベース）

### 安全在庫②：実測値（実績−平均）

```
Δ2(t) = (リードタイム合計実績) - (リードタイム合計平均)
安全在庫② = P95(Δ2)
```

### 安全在庫③：実測値（実績−計画）【推奨】

```
Δ3(t) = (リードタイム合計実績) - (リードタイム合計計画)
安全在庫③ = P95(Δ3)
```

## トラブルシューティング

### よくある問題

1. **データ読み込みエラー**
   - CSVファイルの形式を確認
   - 文字エンコーディングを確認（UTF-8-BOM推奨）

2. **メモリ不足**
   - 分析対象機種数を減らす
   - リードタイムを短くする

3. **EXE起動エラー**
   - 必要なデータファイルが同梱されているか確認
   - 依存関係が正しくインストールされているか確認

## ライセンス

本ツールは社内利用目的で開発されています。

## バージョン履歴

- v1.0.0: 初回リリース
  - 3つの安全在庫モデル実装
  - Streamlit UI実装
  - EXE配布対応
  - トライアル対象3機種での動作確認

## サポート

技術的な問題や要望については、開発チームまでお問い合わせください。