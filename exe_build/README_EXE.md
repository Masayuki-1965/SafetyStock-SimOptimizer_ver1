# SafetyStock-SimOptimizer EXE配布手順書

## 概要

本ドキュメントでは、SafetyStock-SimOptimizerをWindows用EXE（onefolder方式）としてビルドし、社内配布する手順を説明します。

## 前提条件

### ビルド環境
- **Windows 10/11**
- **Python 3.11** がインストールされていること
- インターネット接続（依存関係のダウンロード用）

### 配布先環境
- **Windows 10/11**
- Pythonのインストールは不要（EXEに同梱）
- 管理者権限は不要

## ビルド手順

### 1. ビルドスクリプトの実行

プロジェクトルートディレクトリで `build.bat` を実行します。

```batch
build.bat
```

このスクリプトは以下を自動実行します：

1. Python 3.11の確認
2. 仮想環境（venv）の作成（既存の場合はスキップ）
3. 仮想環境の有効化
4. pipのアップグレード
5. `requirements.txt` からの依存関係インストール
6. PyInstallerによるEXEビルド

### 2. ビルド結果の確認

ビルドが成功すると、以下のディレクトリが作成されます：

```
dist/
└── SafetyStock-SimOptimizer_ver1/
    ├── SafetyStock-SimOptimizer_ver1.exe  # メイン実行ファイル
    ├── config/                            # 設定ファイル
    │   └── settings.json
    ├── assets/                           # アセットファイル（画像等）
    ├── data/                             # データファイル（サンプルデータ含む）
    ├── VERSION.txt                       # バージョン情報
    └── [その他の依存ライブラリファイル]
```

### 3. 動作確認

ビルドされたEXEを実行して動作確認します：

```batch
cd dist\SafetyStock-SimOptimizer_ver1
SafetyStock-SimOptimizer_ver1.exe
```

ブラウザが自動的に起動し、アプリケーションが表示されます（デフォルト: http://localhost:8501）。

## 配布手順

### 1. 配布用フォルダの準備

`dist\SafetyStock-SimOptimizer_ver1` フォルダ全体を配布対象とします。

### 2. 圧縮

配布用にフォルダをZIP圧縮します：

```
SafetyStock-SimOptimizer_ver1_YYYYMMDD.zip
```

### 3. 配布

以下の方法で配布します：

- **社内ファイルサーバー**: 共有フォルダに配置
- **メール**: 小さいサイズの場合（10MB以下推奨）
- **クラウドストレージ**: OneDrive、SharePoint等

## インストール手順（エンドユーザー向け）

### 1. ZIPファイルの展開

配布されたZIPファイルを任意の場所に展開します。

**推奨パス**: `C:\Program Files\SafetyStock-SimOptimizer_ver1` または `C:\Users\<ユーザー名>\AppData\Local\SafetyStock-SimOptimizer_ver1`

### 2. ショートカットの作成（オプション）

デスクトップにショートカットを作成します：

1. `SafetyStock-SimOptimizer_ver1.exe` を右クリック
2. 「ショートカットの作成」を選択
3. ショートカットをデスクトップに移動

### 3. 初回起動

`SafetyStock-SimOptimizer_ver1.exe` をダブルクリックして起動します。

- ブラウザが自動的に起動します
- 初回起動時は数秒かかる場合があります
- ファイアウォールの警告が表示される場合は「許可」を選択してください

## データファイルの配置

### 必須データファイル

アプリケーションを使用するには、以下のデータファイルが必要です：

- `data/日次計画データ.csv` - 日次計画データ
- `data/日次実績データ.csv` - 日次実績データ
- `data/安全在庫データ.csv` - 安全在庫データ（オプション）
- `data/稼働日マスタ.csv` - 稼働日マスタ（オプション）

### データファイルの配置方法

1. **方法1: データフォルダに直接配置**
   - `dist\SafetyStock-SimOptimizer_ver1\data\` フォルダにCSVファイルを配置

2. **方法2: アプリ内でアップロード**
   - アプリケーション起動後、STEP 1のファイルアップロード機能を使用

## ログ・一時ファイルの保存先

アプリケーション実行時に生成されるログと一時ファイルは、以下の場所に保存されます：

```
%APPDATA%\SafetyStock-SimOptimizer\
├── logs\     # ログファイル
└── tmp\      # 一時ファイル
```

**パス例**: `C:\Users\<ユーザー名>\AppData\Roaming\SafetyStock-SimOptimizer\`

## トラブルシューティング

### 問題1: EXEが起動しない

**原因**: 
- ウイルス対策ソフトがブロックしている
- 必要なDLLが不足している

**対処法**:
1. ウイルス対策ソフトの例外リストに追加
2. 管理者権限で実行を試す
3. エラーメッセージを確認（コンソールモードで実行: `console=True` に変更して再ビルド）

### 問題2: ブラウザが起動しない

**原因**:
- ポート8501が使用中
- ファイアウォールがブロックしている

**対処法**:
1. 他のアプリケーションがポート8501を使用していないか確認
2. ファイアウォールの設定を確認
3. 手動でブラウザを開き、`http://localhost:8501` にアクセス

### 問題3: データファイルが読み込めない

**原因**:
- ファイルパスが正しくない
- ファイルのエンコーディングが異なる

**対処法**:
1. データファイルが `data\` フォルダに正しく配置されているか確認
2. CSVファイルのエンコーディングをUTF-8（BOM付き）またはShift-JISに変換

### 問題4: メモリ不足エラー

**原因**:
- データファイルが大きすぎる
- システムリソース不足

**対処法**:
1. データファイルのサイズを確認（推奨: 100MB以下）
2. 他のアプリケーションを終了してメモリを確保

## 技術仕様

### ビルド方式
- **方式**: onefolder（--onedir）
- **エントリーポイント**: `run_app.py`
- **起動方法**: Streamlitをライブラリとして起動

### 同梱ファイル
- `config/` - 設定ファイル
- `assets/` - 静的リソース
- `data/` - サンプルデータ
- `VERSION.txt` - バージョン情報

### 除外ファイル
- `logs/` - 実行時に `%APPDATA%` に作成
- `tmp/` - 実行時に `%APPDATA%` に作成

### 依存関係
- Python 3.11用にビルド
- すべての依存関係はEXEに同梱

## バージョン情報

バージョン情報は `VERSION.txt` に記載されています。

## サポート

問題が発生した場合は、以下を確認してください：

1. 本READMEのトラブルシューティングセクション
2. ログファイル（`%APPDATA%\SafetyStock-SimOptimizer\logs\`）
3. 開発チームへの問い合わせ

## 更新履歴

- **2024-12-XX**: 初版作成（EXE配布対応）
