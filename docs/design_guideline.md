# デザインガイドライン

## 概要

本ドキュメントは、SafetyStock-SimOptimizer_ver1 のUI/UXデザイン統一ルールを定義します。
STEP1/STEP2/STEP3のすべての画面で、一貫性のあるデザインを適用するためのガイドラインです。

## フォント階層ルール

### 基本方針

- フォントサイズは **小数点第1位で四捨五入** し、端数のない値に丸める
- フォントファミリーは `-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Arial', sans-serif` を統一使用

### 階層定義

#### 1. 大項目（STEP名）

- **フォントサイズ**: `1.5rem`（中項目フォントサイズ × 1.1 = 1.4rem × 1.1 = 1.54rem → 1.5remに四捨五入）
- **フォントウェイト**: `bold`
- **色**: `#1A73E8`（青）
- **マージン**: `margin: 0 0 1rem 0`
- **行間**: `line-height: 1.3`
- **CSSクラス**: `.step-header-title` または `.step-main-section`

#### 2. 中項目（画面内の主要セクション見出し）

- **フォントサイズ**: `1.4rem`
- **フォントウェイト**: `bold`
- **色**: `#1A73E8`（青）
- **デザイン**: 左側に4pxの青線（`border-left: 4px solid #1A73E8`）
- **パディング**: `padding-left: 10px`
- **マージン**: `margin-top: 1.5rem`, `margin-bottom: 0.5rem`
- **CSSクラス**: `.step-middle-section`

**使用例**:
```html
<div class="step-middle-section">
    <p>CSVファイルアップロード</p>
</div>
```

#### 3. 小項目（見出し内の項目名）

- **フォントサイズ**: `1.1rem`（中項目フォントサイズ × 0.8 = 1.4rem × 0.8 = 1.12rem → 1.1remに四捨五入）
- **フォントウェイト**: `600`（太字）
- **色**: `#333333`（黒より少し淡い濃グレー）
- **マージン**: `margin: 1rem 0 0.5rem 0`
- **行間**: `line-height: 1.4`
- **先頭記号**: `■`（CSSの`::before`疑似要素で自動追加）
- **CSSクラス**: `.step-sub-section`

**使用例**:
```html
<div class="step-sub-section">機種の選定</div>
```

**表示結果**: `■ 機種の選定`（■は自動的に追加される）

**用途例**:
- ■ 機種の選定
- ■ リードタイムの設定
- ■ 欠品許容率の設定
- ■ 日次計画と日次実績の時系列推移
- ■ リードタイム間差分の統計情報

#### 4. 注釈（補足説明テキスト）

- **フォントサイズ**: `0.9rem`（小項目フォントサイズ × 0.85 = 1.1rem × 0.85 = 0.935rem → 0.9remに四捨五入）
- **フォントウェイト**: `normal`（400）
- **色**: `#555555`（小項目より弱めのグレー）
- **マージン**: `margin: 0.3rem 0`
- **行間**: `line-height: 1.6`
- **CSSクラス**: `.step-annotation`

**使用例**:
```html
<div class="step-annotation">Browse filesでファイルを指定、またはCSVファイルをドラッグ&ドロップしてください。</div>
```

#### 4-1. 補足説明（💡付き）

- **フォントサイズ**: `0.9rem`（注釈と同じ）
- **フォントウェイト**: `normal`（400）
- **色**: `#555555`（小項目より弱めのグレー）
- **マージン**: `margin: 0.3rem 0`
- **行間**: `line-height: 1.6`
- **先頭記号**: `💡`（必須）
- **実装方法**: Streamlitの`st.caption()`を使用

**使用例**:
```python
st.caption("💡 標準偏差は、日次実績データをもとに　√Σ（値 − 平均値）² ÷ データ数 で算出します。安全在庫①（理論値）のみに適用されます。")
```

**統一ルール**:
- すべての補足説明は先頭に`💡`を付ける
- フォントサイズ・デザイン・テイストを統一する
- 小項目の直下に配置する場合が多い
- 色は`#555555`に統一（黒の硬さを避け、UI全体と調和）

#### 4-2. STEP2の補足説明文（※で開始）

- **フォントサイズ**: `0.9rem`（注釈と同じ）
- **フォントウェイト**: `normal`（400）
- **色**: `#555555`（小項目より弱めのグレー）
- **行間**: `line-height: 1.6`
- **先頭記号**: `※`（必須）
- **実装方法**: Streamlitの`st.caption()`を使用

**使用例**:
```python
st.caption("※ 商品コードは「ABC区分｜計画誤差率｜商品コード」の形式で表示されます。")
```

**統一ルール**:
- STEP2の補足説明文はすべて「※」で開始する
- 画面内の補足注釈スタイルは基準に統一する（`st.caption()`を使用）
- HTMLの`<div>`タグや`st.markdown()`のインラインスタイルは使用しない
- フォントサイズ・文字色・テイストを統一する

#### 5. 説明文（ステップ説明テキスト / Body Text）

- **フォントサイズ**: `1.0rem`
- **フォントウェイト**: `normal`（400）
- **色**: `#555555`（小項目より弱めのグレー）
- **マージン**: `margin: 0.3rem 0`
- **行間**: `line-height: 1.6`
- **CSSクラス**: `.step-description`

**使用例**:
```html
<div class="step-description">
    需要データに含まれる統計的な上振れ異常値を検出し、設定した上限値へ補正します。
</div>
```

**用途例**:
- 「データ①〜③は、安全在庫を算出し、現行設定と比較するために必須のデータです。」
- 「機種は実績値（累計）の多い順にソートされています。」
- 「標準偏差は、日次実績データをもとに √Σ（値−平均値）² ÷ データ数 で算出します。」

※ 説明文はステップの意図・ロジック説明用であり、注釈（.step-annotation）とは用途が異なります。
※ 補足説明・注釈・ヒントなど、すべての本文テキストは`#555555`に統一します。

## 青線のデザイン仕様

### 仕様

- **太さ**: `4px`
- **色**: `#1A73E8`（青）
- **位置**: 左側（`border-left`）
- **パディング**: `padding-left: 10px`

### 適用範囲

中項目（`.step-middle-section`）にのみ適用します。

### CSS実装

```css
.step-middle-section {
    border-left: 4px solid #1A73E8;
    padding-left: 10px;
    margin-bottom: 0.5rem;
    margin-top: 1.5rem;
}
```

## 文字色・太字・余白の基本仕様

### 文字色

- **大項目・中項目**: `#1A73E8`（青）
- **小項目**: `#333333`（黒より少し淡い濃グレー）
- **説明文・注釈・補足説明**: `#555555`（小項目より弱めのグレー）

**色調整の目的**:
- 黒（`#000`）の硬さを避け、UI全体の統一感・可読性を高める
- 小項目は"見やすく強調"（`#333333`）、説明文は"情報量を邪魔しない弱め"（`#555555`）に整理
- 全体の階層構造を明確にし、視認性・操作性を向上

### フォントウェイト

- **大項目・中項目**: `bold`
- **小項目**: `600`（太字）
- **説明文・注釈・補足説明**: `normal`（400）

### 余白（マージン）

- **大項目**: `margin: 0 0 1rem 0`（下方向に1rem）
- **中項目**: `margin-top: 1.5rem`, `margin-bottom: 0.5rem`
- **小項目**: `margin: 1rem 0 0.5rem 0`（上下方向）
- **説明文・注釈**: `margin: 0.3rem 0`（上下方向）

### 行間（line-height）

- **大項目・中項目**: `1.3`
- **小項目**: `1.4`
- **説明文・注釈・補足説明**: `1.6`

## テキストボックス型注釈

### 種類

| 種別 | 用途 | クラス | 背景色 | フォント色 | アイコン |
| --- | --- | --- | --- | --- | --- |
| 実行前の説明注釈 | 機能説明・前提条件の提示 | `.annotation-info-box` | `#E9F2FF`（薄い青） | `#1A4DB3`（青） | なし |
| 実行後の結果注釈 | 処理完了・成功メッセージ | `.annotation-success-box` | `#ECF8F2`（薄い緑） | `#2E7D32`（緑） | `✅`（左寄せ） |
| 注意喚起注釈（アクション要求） | CSV未アップロードなど、ユーザーに追加アクションが必要な場合 | `.annotation-warning-box` | `#FFEBEE`（薄い赤） | `#D32F2F`（赤） | `⚠`（左寄せ、太字タイプ） |

### 共通仕様

- 角丸 `12px`
- 余白 `padding: 0.9rem 1.1rem`
- 行間 `line-height: 1.6`
- フォントサイズ `1.0rem`
- `margin: 0.8rem 0`

### 実装例

#### 実行前の説明注釈（薄い青）

```html
<div class="annotation-info-box">
    <strong>デフォルト値</strong>：A区分・B区分の下限値は、累積構成比率50%・80%に相当する値で自動計算されています。必要に応じて手動で調整可能です。
</div>
```

#### 実行後の結果注釈（薄い緑）

```html
<div class="annotation-success-box">
    <span class="icon">✅</span>
    <div class="text">ABC区分の自動生成が完了しました。以下に、ABC区分の集計結果を表示します。</div>
</div>
```

#### 注意喚起注釈（薄い赤）

```html
<div class="annotation-warning-box">
    <span class="icon">⚠</span>
    <div class="text">dataフォルダ内に、必須データ（①〜③）がすべて揃っていません。<br>Browse filesでファイルを指定、またはCSVファイルをドラッグ&ドロップしてください。</div>
</div>
```

### 使用ガイドライン

- **実行前の説明注釈**：機能の説明や前提条件を提示する際に使用
- **実行後の結果注釈**：処理が正常に完了したことを通知する際に使用
- **注意喚起注釈（アクション要求）**：ユーザーに追加のアクション（ファイルアップロードなど）が必要な場合に使用
  - **自動消去仕様**：ユーザーが必要なアクションを完了したら自動で消去する
  - **アイコン**：⚠（太字タイプ）を使用

### 注意喚起注釈の表示条件と消去タイミング

#### CSVファイルアップロードセクション

- **ケース1：必須データ（①〜③）が揃っていない場合**
  - 注意喚起注釈（薄赤）を表示：「dataフォルダ内に、必須データ（①〜③）がすべて揃っていません。（改行）Browse filesでファイルを指定、またはCSVファイルをドラッグ&ドロップしてください。」
  - ①〜③の必須データがすべて揃ったら、この注意喚起注釈は自動で消去

- **ケース2：必須データ（①〜③）がすべて揃っている場合**
  - 実行前の説明注釈（薄青）を表示：「dataフォルダ内に、必須データ（①〜③）がすべて揃っています。（改行）別のデータを使用したい場合は、Browse filesでファイルを指定、またはCSVファイルをドラッグ&ドロップしてください。」

#### ABC区分自動生成セクション

- **ケース3：「現行のABC区分を使用」を選択しているのに、ABC区分データが未アップロードの場合**
  - 注意喚起注釈（薄赤）を表示：「ABC区分データが読み込まれていません。Browse filesでファイルを指定、またはCSVファイルをドラッグ&ドロップしてください。」
  - ABC区分データがアップロードされたら、この注釈は自動で非表示

この3種類のテキストボックス型注釈を画面全体に適用し、一貫性のあるUI/UXを実現します。

### ABC区分確定ボタンのスタイル

- 「ABC区分を自動生成する」「現行のABC区分を反映する」の2ボタンは **同一スタイル** とする
- 仕様
  - 横幅いっぱい（`use_container_width=True`）
  - Streamlitの`type="primary"`を指定し、背景色は既存の赤（`#E53935`）を適用
  - フォントサイズ・角丸・高さは「ABC区分を自動生成する」ボタンと完全一致
  - ボタン上の余白は上下 `1rem`, 左右 `0`
- 「現行のABC区分を反映する」ボタンは、現行データを使用モードに切り替えた際の **確定操作** として必須
- ボタン押下後は集計結果テーブルを即時表示し、必要に応じて注意喚起・成功メッセージを併記する

### メイン画面ボタンの共通スタイル

- 対象: STEP1〜STEP3のメインコンテンツ内に配置するすべてのアクションボタン（※上記2ボタンを含む）
- 基準: 「ABC区分を自動生成する」ボタンの見た目をベースラインとして全ボタンに適用する
- 共通ルール
  - `type="primary"` + `use_container_width=True` を必須指定（横幅はコンテンツ幅いっぱい）
  - 背景色 `#E53935` / 文字色 `#FFFFFF` / ホバー時は `#F44336` にトーンアップ
  - 角丸 `12px`、影なし、ボーダーなし（Streamlit既定枠線を上書き）
  - フォント: `1.2rem`（四捨五入）、`font-weight: 600`、行間 `1.4`
  - **アイコンは使用しない**（📊 📁 🔢 🔄 ✂️ 🔍 📥 などの絵文字アイコンは削除）
  - 高さの目安は `min-height: 56px`、パディングは上下 `1rem` / 左右 `0`
  - 連続ボタンは上下 `1rem` で間隔を統一し、隣接するボタン間の余白も同値
  - 無効状態（`disabled=True`）は背景色 `#F4B1AE`、文字色 `#FFFFFF` を維持して一目で判別できるようにする
- 実装時は `.main-action-button` などの共通クラスでスタイルを一元管理し、ボタン追加時にクラス付与を忘れないこと

## サイドメニューとメイン画面の統一ルール

### サイドメニュー

#### 「分析フロー」タイトル

- **フォントサイズ**: `1.25rem`
- **フォントウェイト**: `bold`
- **色**: `#1A73E8`（青）
- **CSSクラス**: `.sidebar-analysis-flow-title`

#### ステップ名ボタン

- **フォントサイズ**: `1.25rem`
- **フォントウェイト**: `bold`
- **アクティブ状態**: 背景色 `#1A73E8`（青）、文字色 `white`
- **非アクティブ状態**: 背景色 `#E8F0FE`（薄い青）、文字色 `#1A73E8`（青）
- **角丸**: `border-radius: 8px`
- **パディング**: `padding: 0.9rem 1rem`

#### サイドバーの説明文

- **フォントサイズ**: `1.0rem`（メイン画面の説明文と同じ）
- **フォントウェイト**: `normal`（400）
- **色**: `#555555`（メイン画面の説明文と同じ）
- **行間**: `line-height: 1.6`
- **CSSクラス**: `.step-description`（サイドバー内でも使用）

#### サイドバーの小項目

- **フォントサイズ**: `1.1rem`（メイン画面の小項目と同じ）
- **フォントウェイト**: `600`（太字）
- **色**: `#333333`（メイン画面の小項目と同じ）
- **行間**: `line-height: 1.4`
- **先頭記号**: `■`（CSSの`::before`疑似要素で自動追加）
- **CSSクラス**: `.step-sub-section`（サイドバー内でも使用）

### メイン画面

#### STEP名（大項目）

- **背景**: ライトブルーボックス（`background-color: #E8F0FE`）
- **フォントサイズ**: `1.5rem`
- **フォントウェイト**: `bold`
- **色**: `#1A73E8`（青）
- **CSSクラス**: `.step-header-title`（`.step-header-box`内）

## フォント丸めルール

### 基本ルール

すべてのフォントサイズは **小数点第1位で四捨五入** し、端数のない値に丸めます。

### 計算例

1. **大項目**: 1.4rem × 1.1 = 1.54rem → **1.5rem**（四捨五入）
2. **中項目**: 1.4rem → **1.4rem**（そのまま）
3. **小項目**: 1.4rem × 0.8 = 1.12rem → **1.1rem**（四捨五入）
4. **注釈**: 1.1rem × 0.85 = 0.935rem → **0.9rem**（四捨五入）

### 適用範囲

- STEP1、STEP2、STEP3のすべての画面に適用
- サイドメニューも同様のルールを適用

## CSSクラス一覧

### 共通クラス（STEP1/2/3で使用）

- `.step-main-section` - 大項目
- `.step-middle-section` - 中項目（左青線付き）
- `.step-sub-section` - 小項目（#333333、太字600、行間1.4）
- `.step-annotation` - 注釈（#555555、通常400、行間1.6）
- `.step-description` - 説明文（#555555、通常400、行間1.6）

### STEP名クラス

- `.step-header-box` - STEP名の背景ボックス
- `.step-header-title` - STEP名のタイトル

### サイドメニュークラス

- `.sidebar-analysis-flow-title` - 「分析フロー」タイトル

### 互換性クラス（STEP1用）

- `.step1-main-section` - `.step-main-section`のエイリアス
- `.step1-middle-section` - `.step-middle-section`のエイリアス
- `.step1-sub-section` - `.step-sub-section`のエイリアス
- `.step1-annotation` - `.step-annotation`のエイリアス

## 実装チェックリスト

### STEP1/2/3共通

- [ ] 大項目に `.step-main-section` または `.step-header-title` を使用
- [ ] 中項目に `.step-middle-section` を使用（左青線付き）
- [ ] 小項目に `.step-sub-section` を使用（黒太字）
- [ ] 注釈に `.step-annotation` を使用（黒通常）
- [ ] 説明文に `.step-description` を使用（ステップ説明テキスト）
- [ ] フォントサイズが丸めルールに従っている

### デザイン統一

- [ ] すべてのSTEPで同じフォント階層を使用
- [ ] 青線のデザインが統一されている（4px、#1A73E8）
- [ ] 文字色が統一されている（大項目・中項目: 青、小項目: #333333、説明文・注釈: #555555）
- [ ] 余白が統一されている
- [ ] 小項目の行間が1.4、説明文・注釈の行間が1.6に統一されている
- [ ] 小項目のフォントウェイトが600に統一されている
- [ ] 説明文・注釈のフォントウェイトが400に統一されている

## デザイン変更禁止ルール

### テーブルのフォントサイズ・テイスト

- **テーブルのフォントサイズ・テイストは変更禁止**
- 既存のテーブルデザイン（フォントサイズ、色、スタイル）を維持すること
- パス: `@docs/design_guideline.md`

## 更新履歴

- 2025-01-XX: デザイン変更禁止ルールの追加
  - テーブルのフォントサイズ・テイストは変更禁止のルールを追加
  - パス: `@docs/design_guideline.md`
- 2025-01-XX: 小項目・説明文の色調整
  - 小項目の色を`#000000`から`#333333`に変更、フォントウェイトを`600`に統一、行間を`1.4`に設定
  - 説明文・注釈・補足説明の色を`#000000`から`#555555`に変更、フォントウェイトを`400`に統一、行間を`1.6`に設定
  - すべてのSTEP1〜STEP6に適用
  - UI全体の統一感・可読性向上のため
- 2025-01-XX: 初版作成
  - フォント階層ルールの定義
  - 青線デザイン仕様の定義
  - フォント丸めルールの追加
  - STEP共通クラスの定義

